openapi: 3.0.3
info:
  title: "Auth Module API Specification"
  version: 1.0.0
  description: "인증 모듈의 paths와 components 명세 (RegisterRequest 필드 확장 반영)"
paths:
  /api-v1/auth/register:
    post:
      tags:
        - Auth
      summary: 사용자 회원가입
      operationId: registerUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
      responses:
        '200':
          description: 회원가입 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                data: null
                error: null
                success: true
                timestamp: "2025-12-14T03:19:09.9777"
        '400':
          $ref: '#/components/responses/RegisterBadRequestError' # 구체적인 400 에러를 참조
        '409':
          description: 데이터 충돌 (이메일/ID 중복)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                code: "AUTH_004"
                message: "이미 사용 중인 사용자 ID입니다."

  /api-v1/auth/login:
    post:
      tags:
        - Auth
      summary: 사용자 로그인 및 토큰 발급
      operationId: loginUser
      requestBody:
        required: true
        description: 로그인 요청 데이터
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
      responses:
        '200':
          description: 로그인 성공 및 토큰 발급
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                data: null
                error: null
                success: true
                timestamp: "2025-12-14T03:19:09.9777"

        '401':
          $ref: '#/components/responses/LoginUnauthorizedError' # 구체적인 401 에러를 참조
        '400':
          $ref: '#/components/responses/BadRequestError' # 일반적인 400 에러 참조
  /api-v1/auth/logout:
    post:
      tags:
        - Auth
      summary: 사용자 로그아웃 및 Access Token 무효화
      operationId: logoutUser
      description: 현재 사용 중인 Access Token을 블랙리스트에 등록하여 즉시 무효화합니다.
      security:
        - cookieAuth: [ ]
      responses:
        '200':
          description: 로그아웃 성공 (Content-Type이 없는 응답)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                data: null
                error: null
                success: true
                timestamp: "2025-12-14T03:19:09.9777"
        '401':
          $ref: '#/components/responses/UnauthorizedError' # 토큰이 없거나 유효하지 않음 (AUTH_002)
components:
  # --- Security Schemes (인증 방식) ---
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: access_token # 서버가 사용하는 쿠키의 이름 (예시)
      description: '인증 토큰을 HTTP-only 쿠키(ACCESS_TOKEN)를 통해 전송합니다.'


  # --- Schemas (데이터 모델) ---
  schemas:
    RegisterRequest:
      type: object
      required:
        - email
        - password
        - name
        - role
        - tagIds
        - level
      properties:
        email:
          type: string
          format: email
          description: 사용자 이메일 (로그인 ID)
          example: "user@example.com"
        password:
          type: string
          format: password
          description: 사용자 비밀번호
          example: "StrongP@ss123"
        name:
          type: string
          description: 사용자 이름
          example: "홍길동"
        role:
          type: string
          description: 사용자 역할 (LEARNER, INSTRUCTOR)
          example: "LEARNER"
          enum: [ "LEARNER", "INSTRUCTOR", "ADMIN" ]
        tagIds:
          type: array
          items:
            type: integer
            format: int64
          description: 관심사 태그 ID 목록 (최소 3개, 최대 5개)
          example: [ 1, 2, 3 ]
          minItems: 3 # 제약 조건 명시
          maxItems: 5 # 제약 조건 명시
        level:
          type: string
          description: 학습자 수준
          example: "JUNIOR"
          enum: [ "JUNIOR", "MIDDLE", "SENIOR", "EXPERT" ]

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "user@example.com"
        password:
          type: string
          format: password
          example: "StrongP@ss123"

    LoginResponse:
      type: object
      description: 로그인 성공 응답 (토큰은 쿠키로 전달)

    ErrorResponse:
      type: object
      properties:
        code:
          type: string
          description: 내부 에러 코드 (AUTH_004)
          example: "AUTH_004"
        message:
          type: string
          description: 사용자 친화적인 에러 메시지
          example: "이미 사용 중인 사용자 ID입니다."

  # --- Responses (공통 응답) ---
  responses:
    BadRequestError:
      description: 잘못된 요청 형식 (일반적인 유효성 검사 실패)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: "VALIDATION_001"
            message: "Input validation failed: 'email' field is required."

    RegisterBadRequestError:
      description: 회원가입 요청 데이터 유효성 검사 실패
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            TagSizeViolation:
              value:
                code: "AUTH_007"
                message: "태그는 최소 3개, 최대 5개까지 입력해야 합니다."
            MissingField:
              value:
                code: "AUTH_005"
                message: "필수 인증 정보(ID/PW)가 누락되었습니다."

    LoginUnauthorizedError:
      description: 인증 실패 (ID/PW 불일치)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: "AUTH_001"
            message: "아이디 또는 비밀번호가 일치하지 않습니다."

    UnauthorizedError:
      description: 일반적인 인증 실패 (토큰 만료, 형식 오류 등)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: "AUTH_002"
            message: "유효하지 않거나 만료된 토큰입니다."
