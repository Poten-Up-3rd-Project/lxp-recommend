openapi: 3.0.3
info:
  title: "Enrollment Module API"
  version: 1.0.0
  description: "수강 모듈 API 명세"
paths:
  # 수강 API
  /enrollments:
    post:
      tags:
        - Enrollment
      summary: 수강 신청
      description: 특정 사용자가 강의에 수강 신청합니다
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EnrollmentCreateRequest'
      responses:
        '201':
          description: 수강 신청 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnrollmentResponse'
        '400':
          description: 잘못된 요청 (이미 수강 중이거나 취소 불가 조건 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnrollErrorResponse'
        '404':
          description: 강의 또는 사용자를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CourseErrorResponse'
    get:
      tags:
        - Enrollment
      summary: 수강 이력 조회
      description: 사용자의 수강 이력을 페이징으로 조회합니다.
      parameters:
        - name: userId
          in: query
          required: true
          description: 수강 이력을 조회할 사용자 ID
          schema:
            type: string
            format: uuid
          example: "user-uuid-123"
        - name: state
          in: query
          required: false
          description: 수강 상태 필터 (미지정 시 전체)
          schema:
            $ref: '#/components/schemas/EnrollmentState'
        - name: page
          in: query
          schema:
            type: integer
            default: 0
        - name: size
          in: query
          schema:
            type: integer
            default: 20
        - name: sort
          in: query
          description: 정렬 기준 (수강 신청 일시 기준)
          schema:
            $ref: '#/components/schemas/SortOrder'
      responses:
        '200':
          description: 수강 이력 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  content:
                    type: array
                    items:
                      $ref: '#/components/schemas/EnrollmentSummaryResponse'
                  totalElements:
                    type: integer
                  totalPages:
                    type: integer
                  page:
                    type: integer
                  size:
                    type: integer

  /enrollments/{enrollmentId}/cancel:
    post:
      tags:
        - Enrollment
      summary: 수강 취소
      description: 수강 시작 후 3일 이내 등 도메인 규칙에 따라 수강을 취소합니다.
      parameters:
        - name: enrollmentId
          in: path
          required: true
          schema:
            type: long
            format: long
      requestBody:
        required: false
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EnrollmentCancelRequest'
      responses:
        '200':
          description: 수강 취소 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnrollmentResponse'
        '400':
          description: 잘못된 요청 (이미 완료된 수강, 취소 가능 기간 경과 등)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CancelErrorResponse'
        '404':
          description: 수강 정보를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # 진행률 API
  /api-v1/progress/{courseId}:
    get:
      tags:
        - Enrollment
      summary: 강의 진행률 조회
      description: 로그인 된 사용자의 수강중인 강의의 전체 진행률을 조회합니다.
      parameters:
        - name: courseId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CourseProgressResponse'
        '404':
          description: 수강정보를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnrollmentNotFoundResponse'

  /api-v1/progress/{courseId}/list:
    get:
      tags:
        - Enrollment
      summary: 강의 내 강좌별 진행률 조회
      description: 로그인 된 사용자의 수강중인 강의 내 강좌별 진행률을 조회합니다.
      parameters:
        - name: courseId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LectureProgressListResponse'
        '404':
          description: 수강정보를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/EnrollmentNotFoundResponse'

  /api-v1/enrollments/progress/{courseId}/{lectureId}:
    post:
      tags:
        - Enrollment
      summary: 강의 내 강좌 진행도 처리
      description: 로그인 된 사용자가 수강중인 강의 내 특정 강좌 진행 정도를 업데이트 합니다. 전부 봤을시에는 완료 처리 됩니다.
      parameters:
        - name: courseId
          in: path
          required: true
          schema:
            type: string
        - name: lectureId
          in: path
          required: true
          schema:
            type: string
            in: path
            required: true
            schema:
              type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                lastPlayedTime:
                  type: string
                  description: 마지막 강좌 진행 시간
                  example: true
      responses:
        '200':
          description: 성공
        '400':
          description: 잘못된 요청(이미 완료 된 강의 / 전체 강의 시간 초과 요청)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/IllegalLectureProgressRequestError'
        '404':
          description: 강좌 내 강의진행 정보를 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LectureProgressNotFoundError'
components:
  schemas:
    # ==================== Request ====================
    EnrollmentCreateRequest:
      type: object
      required:
        - userId
        - courseId
      properties:
        userId:
          type: string
          format: uuid
          example: "user-uuid-123"
        courseId:
          type: string
          format: uuid
          example: "course-uuid-456"

    EnrollmentCancelRequest:
      type: object
      properties:
        reason:
          type: string
          description: 수강 취소 사유 (선택)
          example: "개인 사정으로 더 이상 수강이 어렵습니다."

    # ==================== Response ====================
    EnrollmentResponse:
      type: object
      properties:
        enrollmentId:
          type: long
          format: long
          example: 35
        state:
          $ref: '#/components/schemas/EnumResponse'
        enrolledAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00"

    EnrollmentSummaryResponse:
      type: object
      properties:
        enrollmentId:
          type: long
          format: long
          example: 23
        state:
          $ref: '#/components/schemas/EnumResponse'
        courseId:
          type: string
          format: uuid
          example: "course-uuid-456"
        thumbnailUrl:
          type: string
          format: string
          example: "http://localhost:8080/1/2/image.jpg"
        totalProgress:
          type: long
          format: long
          example: 99
        courseTitle:
          type: string
          format: string
          example: "백엔드 기초"
        courseDescription:
          type: string
          format: string
          example: "백엔드 기초를 배웁니다"
        level:
          $ref: '#/components/schemas/CourseDifficulty'
        tags:
          type: array
          items:
            $ref: '#/components/schemas/TagResponse'
          example:
            - id: 1
              content: "자바"
              color: "#FF5733"
              variant: "FILLED"
            - id: 2
              content: "backend"
              color: "#33C4FF"
              variant: "OUTLINED"
            - id: 3
              content: "query"
              color: "#A833FF"
              variant: "GHOST"

    TagResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          example: 1
        content:
          type: string
          example: "자바"
        color:
          type: string
          example: "#FF5733"
        variant:
          type: string
          example: "FILLED"
    # ==================== Enum ====================
    EnrollmentState:
      type: string
      enum:
        - ENROLLED
        - COMPLETED
        - CANCELLED
      example: "ENROLLED"

    # Course 모듈과 공유 가능 (예시용으로 재정의)
    EnumResponse:
      type: object
      properties:
        key:
          type: string
          example: "ENROLLED"
        value:
          type: string
          example: "수강 중"

    CourseDifficulty:
      type: string
      enum:
        - JUNIOR
        - MIDDLE
        - SENIOR
        - EXPERT
      example: "JUNIOR"
    # ==================== Error ====================
    ErrorResponse:
      type: object
      properties:
        code:
          type: string
          example: "ENROLLMENT_NOT_FOUND"
        message:
          type: string
          example: "수강 정보를 찾을 수 없습니다."
        group:
          type: string
          example: "ENROLLMENT"
        timestamp:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00"
    CancelErrorResponse:
      type: object
      properties:
        code:
          type: string
          example: "ENROLLMENT_CANCEL_FAIL"
        message:
          type: string
          example: "수강 취소를 할 수 없습니다."
        group:
          type: string
          example: "ENROLLMENT"
        timestamp:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00"
    EnrollErrorResponse:
      type: object
      properties:
        code:
          type: string
          example: "FAIL_ENROLLMENT"
        message:
          type: string
          example: "수강 신청을 할 수 없습니다."
        group:
          type: string
          example: "ENROLLMENT"
        timestamp:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00"
    CourseErrorResponse:
      type: object
      properties:
        code:
          type: string
          example: "COURSE_NOT_FOUND"
        message:
          type: string
          example: "강의를 찾을 수 없습니다."
        group:
          type: string
          example: "COURSE"
        timestamp:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00"
    # ==================== Sort ====================
    SortOrder:
      type: string
      enum:
        - LATEST
        - OLDEST
      default: LATEST
      description: |
        - LATEST: 최근 수강 신청순
        - OLDEST: 오래된 수강 신청순
      example: "LATEST"

    # ================== Progress ==================
    CourseId:
      type: object
      properties:
        courseId:
          type: string
          description: 강좌 고유 ID

    CourseProgressResponse:
      allOf:
        - $ref: '#/components/schemas/CourseId'
        - type: object
          properties:
            progress:
              type: number
              format: float
              description: 진행률 (0.0 ~ 100.0)
      description: 강좌 전체 진행률 응답 객체

    LectureProgressListResponse:
      allOf:
        - $ref: '#/components/schemas/CourseId'
        - type: array
          items:
            type: object
            properties:
              lectureId:
                type: string
                description: 강좌 고유 ID
              lastPlayedTime:
                type: number
                format: string
                description: 마지막 진행했던 시간
              completed:
                type: boolean
                description: 강좌 완료 여부

    EnrollmentNotFoundResponse:
      type: object
      properties:
        code:
          type: string
          example: "ENROLLMENT_NOT_FOUND"
        message:
          type: string
          example: "수강 정보를 찾을 수 없습니다."

    LectureProgressNotFoundError:
      type: object
      properties:
        code:
          type: string
          example: "LECTURE_PROGRESS_NOT_FOUND"
        message:
          type: string
          example: "강의 진행 정보를 찾을 수 없습니다."

    IllegalLectureProgressRequestError:
        type: object
        properties:
          code:
            type: string
            example: "ILLEGAL_LECTURE_PROGRESS_REQUEST"
          message:
            type: string
            example: "잘못된 강의 진행 요청입니다."