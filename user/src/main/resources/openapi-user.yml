openapi: 3.0.3
info:
  title: "User Module API Specification"
  version: 1.0.0
  description: "유저 모듈의 paths와 components 명세 (RegisterRequest 필드 확장 반영)"
paths:
  /api-v1/users:
    get:
      tags:
        - User
      summary: 특정 사용자의 프로필 정보 조회
      operationId: getUserProfile
      security:
        - cookieAuth: [ ] # 인증된 사용자만 접근 가능하도록 설정
      description: |
        **접근 조건:** 1. 요청에 유효한 인증 쿠키가 포함되어야 합니다.
        2. 이 요청은 **인증 쿠키에 포함된 사용자 ID**와 일치하는 본인 프로필만 수정 가능합니다.
      responses:
        '200':
          description: 프로필 정보 조회 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/UserProfileResponse'
        '401':
          description: 인증 실패 (유효하지 않은 토큰)
        '404':
          description: UserProfile을 찾을 수 없음 (해당 ID의 사용자 또는 프로필이 없는 경우)

    patch:
      tags:
        - User
      summary: 사용자 프로필 정보 업데이트 (레벨, 태그, 직업)
      operationId: updateUserProfile
      security:
        - cookieAuth: [ ]
      description: |
        **접근 조건:** 1. 요청에 유효한 인증 쿠키가 포함되어야 합니다.
        2. 이 요청은 **인증 쿠키에 포함된 사용자 ID**와 일치하는 본인 프로필만 수정 가능합니다.
        3. 요청 본문에는 변경할 필드만 포함합니다 (예: 'tags'만 보낼 수 있음).
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: 변경하고자 하는 사용자 이름
                  nullable: true
                  example: "new"
                level:
                  type: string
                  description: 변경하고자 하는 새로운 학습자 레벨
                  nullable: true # 부분 업데이트이므로 null 허용
                  enum: [ "JUNIOR", "MIDDLE", "SENIOR", "EXPERT" ]
                tagIds:
                  type: array
                  description: 사용자가 관심 있는 태그 목록 (전체 교체)
                  nullable: true
                  items:
                    type: integer
                    format: int64
                  example: [ 1, 2, 3 ]
      responses:
        '200':
          description: 프로필 업데이트 성공
          content:
            application/json:
              schema:
                allOf:
                  - $ref: '#/components/schemas/ApiResponse'
                  - type: object
                    properties:
                      data:
                        $ref: '#/components/schemas/UserProfileResponse'
        '403':
          description: 권한 없음 (경로 ID와 토큰 ID 불일치)
        '404':
          description: UserProfile을 찾을 수 없음
    delete:
      tags:
        - User
      summary: 회원 탈퇴 (사용자 계정 삭제/비활성화)
      operationId: deleteUser
      security:
        - cookieAuth: [ ]
      description: |
        **접근 조건:** 1. 요청에 유효한 인증 쿠키가 포함되어야 합니다.
        2. 이 요청은 **인증 쿠키에 포함된 사용자 ID**와 일치하는 본인 계정만 탈퇴(비활성화)할 수 있습니다.
        3. 실제 DB에서는 데이터를 영구 삭제하지 않고, '비활성화' 또는 '삭제됨' 상태로 변경하여 보존하는 것이 일반적입니다.
      responses:
        '200':
          description: 계정 삭제 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                data: null
                error: null
                success: true
                timestamp: "2025-12-14T03:19:09.9777"
        '401':
          description: 인증 실패 (유효하지 않은 토큰)
        '403':
          description: 권한 없음 (경로 ID와 토큰 ID 불일치)
        '404':
          description: 사용자를 찾을 수 없음

  /api-v1/users/role:
    put: # 새로운 정보를 서버에 보낼 때 (로그인, 회원가입 등)
      tags:
        - User
      summary: 사용자 role을 변경
      operationId: promoteToInstructor
      security:
        - cookieAuth: [ ]
      description: | # 엔드포인트 레벨에서 역할 제한을 다시 강조
        **접근 조건:** 1. 요청 쿠키에 **'LEARNER'** 역할 권한이 필수적으로 필요합니다.
        2. 이 요청은 **인증 쿠키에 포함된 사용자 ID**의 역할을 승격합니다.
        3. 요청 본문의 `role` 값은 승격에 해당하는 **'INSTRUCTOR'**여야 합니다.
      x-required-role: LEARNER
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                role:
                  type: string
                  description:
                    변경하고자 하는 새로운 역할 ("INSTRUCTOR")
                  enum: [ "LEARNER", "INSTRUCTOR" ]
                  example: INSTRUCTOR
      responses:
        '200':
          description: 역할 변경 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                data: null
                error: null
                success: true
                timestamp: "2025-12-14T03:19:09.9777"
        '403':
          description: 권한 없음 (요청 토큰의 ID와 경로의 ID가 불일치하거나, 이미 INSTRUCTOR인 경우 등)
        '404':
          description: 사용자를 찾을 수 없음

components:
  schemas:
    UserProfileResponse:
      type: object
      properties:
        userId:
          type: string
          description: 사용자의 고유 ID
        name:
          type: string
          description: 사용자의 이름
        level:
          type: string
          description: 학습자 레벨
        tags:
          type: array
          items:
            type: TagDto
          description: 관심 태그 목록
    TagDto:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Tag의 Id
        content:
          type: string
          description: Tag의 이름

